{"ast":null,"code":"var _jsxFileName = \"/Users/richardhaynes/Developer/Projects/C#/CSharpPracticalDataStructuresAndAlgorithms/src/DataStructures/Queues/PriorityQueue/EmergencyDispatch/EmergencyDispatch/ClientApp/src/components/api-authorization/Logout.js\";\nimport React from 'react';\nimport { Component } from 'react';\nimport authService from './AuthorizeService';\nimport { AuthenticationResultStatus } from './AuthorizeService';\nimport { QueryParameterNames, LogoutActions, ApplicationPaths } from './ApiAuthorizationConstants'; // The main responsibility of this component is to handle the user's logout process.\n// This is the starting point for the logout process, which is usually initiated when a\n// user clicks on the logout button on the LoginMenu component.\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class Logout extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      message: undefined,\n      isReady: false,\n      authenticated: false\n    };\n  }\n\n  componentDidMount() {\n    const action = this.props.action;\n\n    switch (action) {\n      case LogoutActions.Logout:\n        if (!!window.history.state.usr.local) {\n          this.logout(this.getReturnUrl());\n        } else {\n          // This prevents regular links to <app>/authentication/logout from triggering a logout\n          this.setState({\n            isReady: true,\n            message: \"The logout was not initiated from within the page.\"\n          });\n        }\n\n        break;\n\n      case LogoutActions.LogoutCallback:\n        this.processLogoutCallback();\n        break;\n\n      case LogoutActions.LoggedOut:\n        this.setState({\n          isReady: true,\n          message: \"You successfully logged out!\"\n        });\n        break;\n\n      default:\n        throw new Error(`Invalid action '${action}'`);\n    }\n\n    this.populateAuthenticationState();\n  }\n\n  render() {\n    const {\n      isReady,\n      message\n    } = this.state;\n\n    if (!isReady) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 14\n      }, this);\n    }\n\n    if (!!message) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 15\n      }, this);\n    } else {\n      const action = this.props.action;\n\n      switch (action) {\n        case LogoutActions.Logout:\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"Processing logout\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 56,\n            columnNumber: 19\n          }, this);\n\n        case LogoutActions.LogoutCallback:\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"Processing logout callback\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 58,\n            columnNumber: 19\n          }, this);\n\n        case LogoutActions.LoggedOut:\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            children: message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 60,\n            columnNumber: 19\n          }, this);\n\n        default:\n          throw new Error(`Invalid action '${action}'`);\n      }\n    }\n  }\n\n  async logout(returnUrl) {\n    const state = {\n      returnUrl\n    };\n    const isauthenticated = await authService.isAuthenticated();\n\n    if (isauthenticated) {\n      const result = await authService.signOut(state);\n\n      switch (result.status) {\n        case AuthenticationResultStatus.Redirect:\n          break;\n\n        case AuthenticationResultStatus.Success:\n          await this.navigateToReturnUrl(returnUrl);\n          break;\n\n        case AuthenticationResultStatus.Fail:\n          this.setState({\n            message: result.message\n          });\n          break;\n\n        default:\n          throw new Error(\"Invalid authentication result status.\");\n      }\n    } else {\n      this.setState({\n        message: \"You successfully logged out!\"\n      });\n    }\n  }\n\n  async processLogoutCallback() {\n    const url = window.location.href;\n    const result = await authService.completeSignOut(url);\n\n    switch (result.status) {\n      case AuthenticationResultStatus.Redirect:\n        // There should not be any redirects as the only time completeAuthentication finishes\n        // is when we are doing a redirect sign in flow.\n        throw new Error('Should not redirect.');\n\n      case AuthenticationResultStatus.Success:\n        await this.navigateToReturnUrl(this.getReturnUrl(result.state));\n        break;\n\n      case AuthenticationResultStatus.Fail:\n        this.setState({\n          message: result.message\n        });\n        break;\n\n      default:\n        throw new Error(\"Invalid authentication result status.\");\n    }\n  }\n\n  async populateAuthenticationState() {\n    const authenticated = await authService.isAuthenticated();\n    this.setState({\n      isReady: true,\n      authenticated\n    });\n  }\n\n  getReturnUrl(state) {\n    const params = new URLSearchParams(window.location.search);\n    const fromQuery = params.get(QueryParameterNames.ReturnUrl);\n\n    if (fromQuery && !fromQuery.startsWith(`${window.location.origin}/`)) {\n      // This is an extra check to prevent open redirects.\n      throw new Error(\"Invalid return url. The return url needs to have the same origin as the current page.\");\n    }\n\n    return state && state.returnUrl || fromQuery || `${window.location.origin}${ApplicationPaths.LoggedOut}`;\n  }\n\n  navigateToReturnUrl(returnUrl) {\n    return window.location.replace(returnUrl);\n  }\n\n}","map":{"version":3,"names":["React","Component","authService","AuthenticationResultStatus","QueryParameterNames","LogoutActions","ApplicationPaths","Logout","constructor","props","state","message","undefined","isReady","authenticated","componentDidMount","action","window","history","usr","local","logout","getReturnUrl","setState","LogoutCallback","processLogoutCallback","LoggedOut","Error","populateAuthenticationState","render","returnUrl","isauthenticated","isAuthenticated","result","signOut","status","Redirect","Success","navigateToReturnUrl","Fail","url","location","href","completeSignOut","params","URLSearchParams","search","fromQuery","get","ReturnUrl","startsWith","origin","replace"],"sources":["/Users/richardhaynes/Developer/Projects/C#/CSharpPracticalDataStructuresAndAlgorithms/src/DataStructures/Queues/PriorityQueue/EmergencyDispatch/EmergencyDispatch/ClientApp/src/components/api-authorization/Logout.js"],"sourcesContent":["import React from 'react'\r\nimport { Component } from 'react';\r\nimport authService from './AuthorizeService';\r\nimport { AuthenticationResultStatus } from './AuthorizeService';\r\nimport { QueryParameterNames, LogoutActions, ApplicationPaths } from './ApiAuthorizationConstants';\r\n\r\n// The main responsibility of this component is to handle the user's logout process.\r\n// This is the starting point for the logout process, which is usually initiated when a\r\n// user clicks on the logout button on the LoginMenu component.\r\nexport class Logout extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      message: undefined,\r\n      isReady: false,\r\n      authenticated: false\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const action = this.props.action;\r\n    switch (action) {\r\n      case LogoutActions.Logout:\r\n        if (!!window.history.state.usr.local) {\r\n          this.logout(this.getReturnUrl());\r\n        } else {\r\n          // This prevents regular links to <app>/authentication/logout from triggering a logout\r\n          this.setState({ isReady: true, message: \"The logout was not initiated from within the page.\" });\r\n        }\r\n        break;\r\n      case LogoutActions.LogoutCallback:\r\n        this.processLogoutCallback();\r\n        break;\r\n      case LogoutActions.LoggedOut:\r\n        this.setState({ isReady: true, message: \"You successfully logged out!\" });\r\n        break;\r\n      default:\r\n        throw new Error(`Invalid action '${action}'`);\r\n    }\r\n\r\n    this.populateAuthenticationState();\r\n  }\r\n\r\n  render() {\r\n    const { isReady, message } = this.state;\r\n    if (!isReady) {\r\n      return <div></div>\r\n    }\r\n    if (!!message) {\r\n      return (<div>{message}</div>);\r\n    } else {\r\n      const action = this.props.action;\r\n      switch (action) {\r\n        case LogoutActions.Logout:\r\n          return (<div>Processing logout</div>);\r\n        case LogoutActions.LogoutCallback:\r\n          return (<div>Processing logout callback</div>);\r\n        case LogoutActions.LoggedOut:\r\n          return (<div>{message}</div>);\r\n        default:\r\n          throw new Error(`Invalid action '${action}'`);\r\n      }\r\n    }\r\n  }\r\n\r\n  async logout(returnUrl) {\r\n    const state = { returnUrl };\r\n    const isauthenticated = await authService.isAuthenticated();\r\n    if (isauthenticated) {\r\n      const result = await authService.signOut(state);\r\n      switch (result.status) {\r\n        case AuthenticationResultStatus.Redirect:\r\n          break;\r\n        case AuthenticationResultStatus.Success:\r\n          await this.navigateToReturnUrl(returnUrl);\r\n          break;\r\n        case AuthenticationResultStatus.Fail:\r\n          this.setState({ message: result.message });\r\n          break;\r\n        default:\r\n          throw new Error(\"Invalid authentication result status.\");\r\n      }\r\n    } else {\r\n      this.setState({ message: \"You successfully logged out!\" });\r\n    }\r\n  }\r\n\r\n  async processLogoutCallback() {\r\n    const url = window.location.href;\r\n    const result = await authService.completeSignOut(url);\r\n    switch (result.status) {\r\n      case AuthenticationResultStatus.Redirect:\r\n        // There should not be any redirects as the only time completeAuthentication finishes\r\n        // is when we are doing a redirect sign in flow.\r\n        throw new Error('Should not redirect.');\r\n      case AuthenticationResultStatus.Success:\r\n        await this.navigateToReturnUrl(this.getReturnUrl(result.state));\r\n        break;\r\n      case AuthenticationResultStatus.Fail:\r\n        this.setState({ message: result.message });\r\n        break;\r\n      default:\r\n        throw new Error(\"Invalid authentication result status.\");\r\n    }\r\n  }\r\n\r\n  async populateAuthenticationState() {\r\n    const authenticated = await authService.isAuthenticated();\r\n    this.setState({ isReady: true, authenticated });\r\n  }\r\n\r\n  getReturnUrl(state) {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const fromQuery = params.get(QueryParameterNames.ReturnUrl);\r\n    if (fromQuery && !fromQuery.startsWith(`${window.location.origin}/`)) {\r\n      // This is an extra check to prevent open redirects.\r\n      throw new Error(\"Invalid return url. The return url needs to have the same origin as the current page.\")\r\n    }\r\n    return (state && state.returnUrl) ||\r\n      fromQuery ||\r\n      `${window.location.origin}${ApplicationPaths.LoggedOut}`;\r\n  }\r\n\r\n  navigateToReturnUrl(returnUrl) {\r\n    return window.location.replace(returnUrl);\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}